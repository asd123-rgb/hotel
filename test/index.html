<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My App</title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>

<body>
<div id="app">
    <!-- Навигационное меню -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#" @click="openPage('index')">My App</a>
            <div class="navbar-nav">
                <a class="nav-link" :class="{active: page === 'index'}" id="indexLink" href="#" @click="openPage('index')">Главная</a>
                <a class="nav-link" :class="{active: page === 'register'}" id="registerLink" href="#" @click="openPage('register')" v-if="!currentUser.token">Регистрация</a>
                <a class="nav-link" :class="{active: page === 'login'}" id="loginLink" href="#" @click="openPage('login')" v-if="!currentUser.token">Войти</a>
                <a class="nav-link" :class="{active: page === 'profile'}" id="profileLink" href="#" @click="openPage('profile')" v-if="currentUser.token">Профиль</a>
                <a class="nav-link" href="#" @click="exit()" v-if="currentUser.token">Выйти</a>
            </div>
        </div>
    </nav>
    <!-- Навигационное меню -->

    <!-- Основное содержимое -->
    <div class="container py-5">
        <!-- Главная страница -->
        <div v-if="page === 'index'" key="index" id="indexPage">
            <div class="row">
                <div v-for="post in posts" class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <div class="card">
                        <img :src="post.image" class="card-img-top" alt="">
                        <div class="card-body">
                            <div class="badge bg-success mb-3">{{post.user}}</div>
                            <h5 class="card-title">{{post.name}}</h5>
                            <p class="card-text">{{post.text}}</p>
                            <a href="#" class="btn btn-primary" @click="getPost(post)" value="asd">Читать пост</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Главная страница -->

        <!-- Страница регистрации -->
        <div v-if="page === 'register'" key="register" id="registerPage">
            <h1>Регистрация</h1>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerName">Имя</label>
                    <input type="text" class="form-control" id="registerName" placeholder="Введите имя" v-model="registerUser.name">
                </div>
                <div class="form-group">
                    <label for="registerLogin">Логин</label>
                    <input type="text" class="form-control" id="registerLogin" placeholder="Введите логин" v-model="registerUser.login">
                </div>
                <div class="form-group">
                    <label for="registerPassword">Пароль</label>
                    <input type="password" class="form-control" id="registerPassword" placeholder="Введите пароль" v-model="registerUser.password">
                </div>
                <button type="submit" class="btn btn-primary mt-2" @click.prevent="register">Зарегистрироваться</button>
            </form>
        </div>
        <!-- Страница регистрации -->

        <!-- Страница входа -->
        <div v-if="page === 'login'" key="login" id="loginPage">
            <h1>Вход</h1>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginLogin" >Логин</label>
                    <input type="text" class="form-control" id="loginLogin" placeholder="Введите логин" v-model="loginUser.login">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Пароль</label>
                    <input type="password" class="form-control" id="loginPassword" placeholder="Введите пароль" v-model="loginUser.password">
                </div>
                <button type="submit" class="btn btn-primary mt-2" @click.prevent="login">Войти</button>
            </form>
        </div>
        <!-- Страница входа -->

        <!-- Страница поста -->
        <div v-if="page === 'post'" key="post" id="postPage">
            <h2 class="mb-4">{{post.name}}</h2>

            <img :src="post.image" width="200" alt="">

            <p>{{post.text}}</p>

            <h4 class="mt-3">Комментарии</h4>

            <form class="mb-4" v-if="this.currentUser.token!=null">
                <textarea rows="3" class="form-control" placeholder="Введите комментарий" v-model="commentText"></textarea>
                <button class="btn btn-success mt-2" @click.prevent="addComment(post)">Отправить</button>
            </form>

            <div class="comments" v-for="comment in post.comments">
                <!-- Комментарий -->
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <h5 class="card-title">{{comment.user}}</h5>
                            <small class="card-text text-muted">{{comment.created_at.slice(0, 19).replace('T'," ")}}</small>
                        </div>
                        <p class="card-text">{{comment.text}}</p>
                    </div>
                </div>
                <!-- / Комментарий -->
            </div>
        </div>
        <!-- / Страница поста -->

        <!-- Создание поста -->
        <div v-if="page === 'createPost'" key="createPost" id ="createPostPage">
            <h2 class="mb-4">Создание поста</h2>

            <form>
                <div class="mb-3">
                    <label class="form-label">Название поста</label>
                    <input type="text" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Текст поста</label>
                    <textarea class="form-control" rows="10"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Изображение</label>
                    <input type="file" class="form-control">
                </div>
                <button type="submit" class="btn btn-success mt-4">Создать пост</button>
            </form>
        </div>
        <!-- / Создание поста -->

        <!-- Страница профиля -->
        <div v-if="page === 'profile'" key="profile" id="profilePage">
            <h2 class="mb-4">Добро пожаловать, {{currentUser.name}}!</h2>
            

            <table class="table">
                <tr>
                    <th>ID</th>
                    <th>Название поста</th>
                    <th>Дата создания</th>
                    <th>Действия</th>
                </tr>

                <tr v-for="post in myPosts">
                    <td>{{post.id}}</td>
                    <td>{{post.name}}</td>
                    <td>{{post.created_at.slice(0, 19).replace('T'," ")}}</td>
                    <td>
                        <button class="btn btn-primary" @click.prevent=getPost(post)>Перейти к посту</button>
                        <button class="btn btn-danger" @click.prevent=deletePost(post)>Удалить пост</button>
                    </td>
                </tr>
            </table>
        </div>
        <!-- Страница профиля -->
    </div>
    <!-- Основное содержимое -->
</div>

<script src="app.js"></script>
</body>

</html>